<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">


<div class="table_view">
  <div class="logs-header">
    <h2 class="logs-title">Logs</h2>
    <span class="logs-count">{{ getRowCount() }} total</span>
  </div>

  <p class="logs-description">View all detected road damages</p>

  <div class="search-container">
    <div class="search-container">
      <input
        type="text"
        placeholder="Search logs..."
        class="search-bar"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
      />
    </div>

    <div class="actions-container">
      <button *ngIf="!deleteMode" (click)="enableDeleteMode()" class="delete-button">Delete</button>
      <button *ngIf="deleteMode" (click)="cancelDeleteMode()" class="cancel-button">Cancel</button>

      <div class="pagination-controls">
        <button class="nav-button" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
          &lt;
        </button>

        <ng-container *ngFor="let page of [].constructor(getTotalPages()); let pageNum = index">
          <button
            (click)="changePage(pageNum + 1)"
            [class.active]="currentPage === (pageNum + 1)"
          >
            {{ pageNum + 1 }}
          </button>
        </ng-container>

        <button
          class="nav-button"
          (click)="changePage(currentPage + 1)"
          [disabled]="currentPage === getTotalPages()"
        >
          &gt;
        </button>
      </div>
    </div>
  </div>

  <div class="logs-table-wrapper">
    <table class="logs-table">
      <thead>
        <tr>
          <th></th>
          <th>Image</th>
          <th (click)="sortTableBy('confidence')" class="sortable">
            Confidence
            <span class="sort-arrow" [class.visible]="currentSort.column === 'confidence'">
              {{ currentSort.column === 'confidence' ? (currentSort.direction === 'asc' ? '▲' : '▼') : '▲' }}
            </span>
          </th>
          <th (click)="sortTableBy('date')" class="sortable">
            Date
            <span class="sort-arrow" [class.visible]="currentSort.column === 'date'">
              {{ currentSort.column === 'date' ? (currentSort.direction === 'asc' ? '▲' : '▼') : '▲' }}
            </span>
          </th>
          <th (click)="sortTableBy('location')" class="sortable">
            Location
            <span class="sort-arrow" [class.visible]="currentSort.column === 'location'">
              {{ currentSort.column === 'location' ? (currentSort.direction === 'asc' ? '▲' : '▼') : '▲' }}
            </span>
          </th>
          <th (click)="sortTableBy('prediction')" class="sortable">
            Prediction
            <span class="sort-arrow" [class.visible]="currentSort.column === 'prediction'">
              {{ currentSort.column === 'prediction' ? (currentSort.direction === 'asc' ? '▲' : '▼') : '▲' }}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of getPaginatedData(); let i = index" class="clickable-row">
          <td>
            <input *ngIf="deleteMode" type="checkbox" [(ngModel)]="item.selected" (change)="checkSelectedRows()" />
          </td>
          <td><img [src]="item.image" alt="Item Image" class="image-small-rounded" /></td>
          <td>{{ item.confidence }}</td>
          <td>{{ item.readableDate | date:'medium' }}</td>
          <td>
            <div class="location-container">
              <span class="location-text">{{ item.address || 'Loading address...' }}</span>
              <span class="address-text">{{ formatLocation(item.location) }}</span>
            </div>
          </td>
          <td>{{ item.prediction }}</td>
          <td>
            <i class="fa-solid fa-eye" style="margin-right: 8px;"  (click)="openRowModal(item)"></i>
            <i class="fa-solid fa-pen-to-square" style="margin-right: 8px;"></i>
            <i class="fa-solid fa-trash-can" style="color: red;"></i>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <button *ngIf="showConfirmDeletion" class="confirm-deletion-button" (click)="openDeletionModal()">Confirm Deletion</button>
</div>

<!-- MODAL -->
<div *ngIf="showDeletionModal" class="floating-modal">
  <div class="floating-modal-content">
    <h3 class="modal-title">Confirm Deletion</h3>
    <p class="modal-body">
      You are about to delete {{ rowsToDeleteCount }} {{ rowsToDeleteCount === 1 ? 'log' : 'logs' }}. Proceed?
    </p>
    <div class="modal-buttons">
      <button class="modal-confirm" (click)="confirmDeletionInModal()">Yes, Delete</button>
      <button class="modal-cancel" (click)="cancelDeletionInModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div *ngIf="showRowModal" class="details-modal">
  <div class="details-modal-content">
    <!-- Big Image at the top -->
    <img [src]="selectedRowData?.image" alt="Item Image" class="details-image-large" />
    
    <!-- Details Section -->
    <div class="details-section">
      <div class="details-left">
        <!-- Display the address instead of the location object -->
        <p style="padding-top: 0."><b>{{ selectedRowData?.address || 'Address not available' }}</b></p>
        <p style="margin: 0; color: gray">{{ selectedRowData?.readableDate | date: 'medium' }}</p>
      </div>
      
      <div class="details-right">
        <p style="display: inline-block; background-color: orange; padding: 0.1rem 1rem; border-radius: 5000px; color: white;">
          {{ selectedRowData?.prediction }}</p>
          <p style="margin: 0; color: gray">{{ selectedRowData?.confidence * 100 | number:'1.0-0' }}% Confidence</p>
        </div>
    </div>
    <!-- Close Button -->
    <button class="details-modal-confirm" (click)="closeRowModal()">Close</button>
  </div>
</div>


